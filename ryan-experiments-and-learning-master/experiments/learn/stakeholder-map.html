<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Healthcare Stakeholder Map - Understand the System</title>
  <meta name="description" content="Interactive map of healthcare stakeholders, their relationships, power dynamics, and available transparency data.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="../shared/styles.css">
  <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
  <script src="stakeholder-data.js"></script>
  <style>
    /* Stakeholder Map Specific Styles */
    .stakeholder-map-container {
      min-height: 800px;
      margin: 48px 0;
    }

    #cy-container {
      width: 100%;
      background: var(--color-gray-50);
      border-radius: var(--radius-xl);
      border: 2px solid var(--color-gray-200);
      height: 800px;
      position: relative;
    }

    #cy {
      width: 100%;
      height: 100%;
      border-radius: var(--radius-xl);
    }

    .view-controls {
      position: absolute;
      top: 16px;
      left: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 10;
    }

    .view-mode-btn {
      padding: 8px 16px;
      background: white;
      border: 2px solid var(--color-gray-300);
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      font-weight: var(--font-semibold);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .view-mode-btn:hover {
      border-color: var(--color-patient-primary);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .view-mode-btn.active {
      background: var(--color-patient-primary);
      color: white;
      border-color: var(--color-patient-primary);
    }

    .view-legend {
      position: absolute;
      bottom: 16px;
      left: 16px;
      background: white;
      padding: 16px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      z-index: 10;
      max-width: 250px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: var(--text-sm);
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: var(--radius-sm);
      flex-shrink: 0;
    }

    /* Modal Overlay Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      overflow-y: auto;
      padding: 24px;
      animation: fadeIn 0.2s ease-out;
    }

    .modal-overlay.visible {
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      border-radius: var(--radius-xl);
      width: 90%;
      max-width: 1200px;
      margin: 48px auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease-out;
      position: relative;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      padding: 32px;
      border-bottom: 2px solid var(--color-gray-200);
    }

    .modal-icon {
      width: 64px;
      height: 64px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      flex-shrink: 0;
    }

    .modal-close {
      cursor: pointer;
      font-size: 32px;
      color: var(--color-gray-600);
      line-height: 1;
      padding: 8px;
      border-radius: var(--radius-md);
      transition: all 0.2s;
    }

    .modal-close:hover {
      color: var(--color-error);
      background: var(--color-gray-100);
    }

    .modal-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      padding: 32px;
      max-height: calc(100vh - 300px);
      overflow-y: auto;
    }

    .modal-main-content {
      /* Left column - main content */
    }

    .modal-sidebar-content {
      /* Right column - data sources, actions */
    }

    .metric-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 16px 0;
    }

    .metric-card {
      background: var(--color-gray-50);
      padding: 12px;
      border-radius: var(--radius-md);
    }

    .metric-label {
      font-size: var(--text-xs);
      color: var(--color-gray-600);
      margin-bottom: 4px;
      text-transform: uppercase;
      font-weight: var(--font-semibold);
    }

    .metric-value {
      font-size: var(--text-lg);
      font-weight: var(--font-bold);
      color: var(--color-gray-900);
    }

    .data-source-list {
      margin: 16px 0;
    }

    .data-source-item {
      background: var(--color-gray-50);
      padding: 12px;
      border-radius: var(--radius-md);
      margin-bottom: 8px;
    }

    .data-source-name {
      font-weight: var(--font-semibold);
      color: var(--color-gray-900);
      margin-bottom: 4px;
    }

    .data-source-records {
      font-size: var(--text-sm);
      color: var(--color-patient-primary);
      margin-bottom: 4px;
    }

    .data-source-desc {
      font-size: var(--text-sm);
      color: var(--color-gray-700);
    }

    .data-gap-item {
      background: var(--color-error-light);
      border-left: 3px solid var(--color-error);
      padding: 12px;
      border-radius: var(--radius-md);
      margin-bottom: 8px;
    }

    .gap-priority {
      display: inline-block;
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: var(--text-xs);
      font-weight: var(--font-bold);
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .gap-priority.highest {
      background: var(--color-error);
      color: white;
    }

    .gap-priority.high {
      background: var(--color-warning);
      color: white;
    }

    .gap-priority.medium {
      background: var(--color-gray-400);
      color: white;
    }

    .incentive-list {
      margin: 8px 0;
    }

    .incentive-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 4px;
      font-size: var(--text-sm);
    }

    .incentive-item i {
      margin-top: 2px;
      flex-shrink: 0;
    }

    .query-example {
      background: var(--color-patient-light);
      border-left: 3px solid var(--color-patient-primary);
      padding: 12px;
      border-radius: var(--radius-md);
      margin-bottom: 8px;
      font-size: var(--text-sm);
      font-style: italic;
      color: var(--color-gray-800);
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 16px;
    }

    /* Educational modules */
    .education-module {
      margin-bottom: 24px;
    }

    .module-header {
      background: linear-gradient(135deg, var(--color-patient-primary), var(--color-patient-secondary));
      color: white;
      padding: 16px 24px;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .module-header h3 {
      margin: 0;
      font-size: var(--text-xl);
      font-weight: var(--font-bold);
      color: white;
    }

    .module-toggle-icon {
      font-size: 24px;
      transition: transform 0.3s;
    }

    .module-header.collapsed .module-toggle-icon {
      transform: rotate(-90deg);
    }

    .module-content {
      background: white;
      border: 2px solid var(--color-gray-200);
      border-top: none;
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
      padding: 24px;
      display: none;
    }

    .module-content.visible {
      display: block;
    }

    .money-flow-viz {
      background: var(--color-gray-50);
      padding: 24px;
      border-radius: var(--radius-lg);
      margin: 16px 0;
    }

    .flow-step {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }

    .flow-amount {
      font-size: var(--text-2xl);
      font-weight: var(--font-bold);
      min-width: 100px;
    }

    .flow-arrow {
      font-size: 32px;
      color: var(--color-gray-400);
    }

    .flow-description {
      flex: 1;
    }

    @media (max-width: 768px) {
      #cy-container {
        height: 500px;
      }

      .modal-overlay {
        padding: 0;
      }

      .modal-content {
        width: 100%;
        max-width: 100%;
        margin: 0;
        border-radius: 0;
        min-height: 100vh;
      }

      .modal-body {
        grid-template-columns: 1fr;
        gap: 24px;
        max-height: none;
      }

      .modal-header {
        padding: 24px;
      }

      .modal-icon {
        width: 48px;
        height: 48px;
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="../index.html" class="logo">Healthcare Transparency</a>
      <nav class="nav">
        <a href="../patients/index.html">For Patients</a>
        <a href="../employers/index.html">For Employers</a>
        <a href="../providers/index.html">For Providers</a>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero" style="background: linear-gradient(135deg, var(--color-patient-light) 0%, var(--color-white) 100%);">
    <div class="container">
      <h1 class="hero-title" style="color: var(--color-patient-primary);">
        Healthcare Stakeholder Map
      </h1>
      <p class="hero-subtitle">
        Understand who controls healthcare, where money flows, and what data reveals the truth.
        <br>
        <strong>Interactive visualization showing the ecosystem, incentives, and power dynamics.</strong>
      </p>
    </div>
  </section>

  <!-- Educational Modules -->
  <section class="section bg-gray-50">
    <div class="container">
      <h2 class="section-title">Understanding The Healthcare System</h2>
      <p class="section-subtitle">Click each module to learn more</p>

      <!-- Module 1: Money Flows -->
      <div class="education-module">
        <div class="module-header" onclick="toggleModule(1)">
          <h3><i class="fa-solid fa-dollar-sign" style="margin-right: 8px;"></i> Where Your Healthcare Dollar Actually Goes</h3>
          <i class="fa-solid fa-chevron-down module-toggle-icon"></i>
        </div>
        <div class="module-content" id="module-1">
          <p style="font-size: var(--text-lg); margin-bottom: 16px;">
            <strong>For every $100 an employer spends on healthcare, here's the breakdown:</strong>
          </p>

          <div class="money-flow-viz">
            <div class="flow-step">
              <div class="flow-amount" style="color: var(--color-gray-900);">$100</div>
              <div class="flow-arrow"><i class="fa-solid fa-arrow-right"></i></div>
              <div class="flow-description">
                <strong>Employer pays TPA/Carrier</strong><br>
                Full premium for employee healthcare
              </div>
            </div>

            <div class="flow-step">
              <div class="flow-amount" style="color: var(--color-error);">-$15-23</div>
              <div class="flow-arrow"><i class="fa-solid fa-arrow-down"></i></div>
              <div class="flow-description">
                <strong>Leaks to Middlemen</strong><br>
                Spread pricing, float income, hidden fees, PBM rebate retention
              </div>
            </div>

            <div class="flow-step">
              <div class="flow-amount" style="color: var(--color-warning);">-$5-15</div>
              <div class="flow-arrow"><i class="fa-solid fa-arrow-down"></i></div>
              <div class="flow-description">
                <strong>Wasted on Overpriced/Low-Quality Care</strong><br>
                Monopoly pricing, unnecessary procedures, poor outcomes
              </div>
            </div>

            <div class="flow-step">
              <div class="flow-amount" style="color: var(--color-success);">$62-70</div>
              <div class="flow-arrow"><i class="fa-solid fa-arrow-right"></i></div>
              <div class="flow-description">
                <strong>Actually reaches providers</strong><br>
                Payment for actual care delivered
              </div>
            </div>
          </div>

          <div class="alert alert-error">
            <div>
              <strong>The Problem:</strong> 30-40% of healthcare spending is wasted on middlemen fees and overpriced care.
              That's $100-140 BILLION annually that doesn't improve anyone's health.
            </div>
          </div>

          <div class="alert alert-success" style="margin-top: 16px;">
            <div>
              <strong>The Solution:</strong> Transparency reveals where money leaks. Employers can use data to benchmark rates,
              detect spread pricing, and build direct contracts with high-value providers.
            </div>
          </div>
        </div>
      </div>

      <!-- Module 2: Power Dynamics -->
      <div class="education-module">
        <div class="module-header collapsed" onclick="toggleModule(2)">
          <h3><i class="fa-solid fa-scale-unbalanced" style="margin-right: 8px;"></i> Who Has Power (And Who Doesn't)</h3>
          <i class="fa-solid fa-chevron-down module-toggle-icon"></i>
        </div>
        <div class="module-content" id="module-2">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card">
              <h4 style="font-size: var(--text-lg); font-weight: var(--font-bold); color: var(--color-error); margin-bottom: 16px;">
                <i class="fa-solid fa-crown" style="margin-right: 8px;"></i> Current Power Holders
              </h4>
              <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="padding: 8px 0; border-bottom: 1px solid var(--color-gray-200);">
                  <strong>TPAs/Carriers:</strong> Control network access, claims data, payment timing
                </li>
                <li style="padding: 8px 0; border-bottom: 1px solid var(--color-gray-200);">
                  <strong>Hospital Monopolies:</strong> Must-have status in networks, pricing leverage
                </li>
                <li style="padding: 8px 0; border-bottom: 1px solid var(--color-gray-200);">
                  <strong>PBMs:</strong> Formulary control, rebate opacity, spread pricing
                </li>
                <li style="padding: 8px 0;">
                  <strong>Conflicted Consultants:</strong> Employer relationships funded by vendors
                </li>
              </ul>
            </div>

            <div class="card">
              <h4 style="font-size: var(--text-lg); font-weight: var(--font-bold); color: var(--color-warning); margin-bottom: 16px;">
                <i class="fa-solid fa-users" style="margin-right: 8px;"></i> Powerless (But Paying)
              </h4>
              <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="padding: 8px 0; border-bottom: 1px solid var(--color-gray-200);">
                  <strong>Employers:</strong> Pay the bills but lack data and expertise
                </li>
                <li style="padding: 8px 0; border-bottom: 1px solid var(--color-gray-200);">
                  <strong>Patients:</strong> Bear costs but have no price/quality information
                </li>
                <li style="padding: 8px 0; border-bottom: 1px solid var(--color-gray-200);">
                  <strong>High-Quality Providers:</strong> Better care, fair prices, but excluded from networks
                </li>
                <li style="padding: 8px 0;">
                  <strong>Regulators:</strong> Enforcement authority but underfunded and lobbied
                </li>
              </ul>
            </div>
          </div>

          <div class="alert alert-warning" style="margin-top: 24px;">
            <div>
              <strong>The Power Imbalance:</strong> Those who bear the financial risk (employers & patients) and those who
              deliver actual value (high-quality providers) have the LEAST power. Those who extract value without risk have the MOST power.
            </div>
          </div>

          <div class="alert alert-success" style="margin-top: 16px;">
            <div>
              <strong>Transparency Shifts Power:</strong> Data reveals who's overcharging, who's providing value, and who's taking fees.
              This shifts negotiating leverage from middlemen to employers and patients.
            </div>
          </div>
        </div>
      </div>

      <!-- Module 3: What Changes With Transparency -->
      <div class="education-module">
        <div class="module-header collapsed" onclick="toggleModule(3)">
          <h3><i class="fa-solid fa-lightbulb" style="margin-right: 8px;"></i> What Transparency Changes</h3>
          <i class="fa-solid fa-chevron-down module-toggle-icon"></i>
        </div>
        <div class="module-content" id="module-3">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="card" style="text-align: center;">
              <div style="font-size: 48px; margin-bottom: 16px; color: var(--color-success);"><i class="fa-solid fa-briefcase"></i></div>
              <h4 style="font-size: var(--text-lg); font-weight: var(--font-bold); margin-bottom: 12px;">Employers Can</h4>
              <ul style="list-style: none; padding: 0; margin: 0; text-align: left; font-size: var(--text-sm);">
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Benchmark their rates vs. market</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Calculate TPA spread pricing</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Find high-value providers</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Build direct contracts</li>
                <li><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Meet CAA fiduciary duty</li>
              </ul>
            </div>

            <div class="card" style="text-align: center;">
              <div style="font-size: 48px; margin-bottom: 16px; color: var(--color-success);"><i class="fa-solid fa-hospital"></i></div>
              <h4 style="font-size: var(--text-lg); font-weight: var(--font-bold); margin-bottom: 12px;">Patients Can</h4>
              <ul style="list-style: none; padding: 0; margin: 0; text-align: left; font-size: var(--text-sm);">
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> See prices before treatment</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Compare provider costs</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Choose based on quality</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Avoid surprise bills</li>
                <li><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Pay fair cash prices</li>
              </ul>
            </div>

            <div class="card" style="text-align: center;">
              <div style="font-size: 48px; margin-bottom: 16px; color: var(--color-success);"><i class="fa-solid fa-user-doctor"></i></div>
              <h4 style="font-size: var(--text-lg); font-weight: var(--font-bold); margin-bottom: 12px;">Providers Can</h4>
              <ul style="list-style: none; padding: 0; margin: 0; text-align: left; font-size: var(--text-sm);">
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Prove their value proposition</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> See market positioning</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Reach employers directly</li>
                <li style="margin-bottom: 8px;"><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Compete on quality+price</li>
                <li><i class="fa-solid fa-check" style="color: var(--color-success); margin-right: 8px;"></i> Skip TPA middlemen</li>
              </ul>
            </div>
          </div>

          <div class="alert alert-success" style="margin-top: 24px;">
            <div>
              <strong>The Transformation:</strong> When information is symmetric, value providers win. Quality, outcomes, and fair
              pricing become competitive advantages instead of liabilities. The race to the bottom on price (with quality collapse)
              reverses to a race to the top on value (quality at fair prices).
            </div>
          </div>
        </div>
      </div>

      <!-- Module 4: Available Data -->
      <div class="education-module">
        <div class="module-header collapsed" onclick="toggleModule(4)">
          <h3><i class="fa-solid fa-database" style="margin-right: 8px;"></i> What Data Exists (And What's Missing)</h3>
          <i class="fa-solid fa-chevron-down module-toggle-icon"></i>
        </div>
        <div class="module-content" id="module-4">
          <h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); color: var(--color-success); margin-bottom: 16px;">
            <i class="fa-solid fa-circle-check" style="margin-right: 8px;"></i> Available Now (Thanks to Federal Transparency Laws)
          </h4>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4" style="margin-bottom: 32px;">
            <div class="data-source-item">
              <div class="data-source-name">Transparency in Coverage (TiC) Files</div>
              <div class="data-source-records">500M+ negotiated rates</div>
              <div class="data-source-desc">What TPAs/carriers actually pay providers by CPT code, updated monthly</div>
            </div>

            <div class="data-source-item">
              <div class="data-source-name">Hospital Transparency MRFs</div>
              <div class="data-source-records">300K+ hospital rates</div>
              <div class="data-source-desc">Hospital pricing by procedure, cash prices, payer-specific rates</div>
            </div>

            <div class="data-source-item">
              <div class="data-source-name">NPPES Provider Directory</div>
              <div class="data-source-records">7M+ providers</div>
              <div class="data-source-desc">Provider names, locations, specialties, NPIs</div>
            </div>

            <div class="data-source-item">
              <div class="data-source-name">Medicare Benchmarks</div>
              <div class="data-source-records">All CPT codes</div>
              <div class="data-source-desc">Government reimbursement rates as fair pricing baseline</div>
            </div>

            <div class="data-source-item">
              <div class="data-source-name">Employer Reporting Plans</div>
              <div class="data-source-records">50K+ self-insured plans</div>
              <div class="data-source-desc">Which employers use which TPAs/carriers</div>
            </div>

            <div class="data-source-item">
              <div class="data-source-name">NUCC Taxonomy</div>
              <div class="data-source-records">Provider specialties</div>
              <div class="data-source-desc">Classification system for provider types and specializations</div>
            </div>
          </div>

          <h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); color: var(--color-error); margin-bottom: 16px;">
            <i class="fa-solid fa-circle-xmark" style="margin-right: 8px;"></i> Critical Gaps (What We Need)
          </h4>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="data-gap-item">
              <span class="gap-priority highest">HIGHEST PRIORITY</span>
              <div class="data-source-name">Provider Quality & Safety Data</div>
              <div class="data-source-desc" style="margin-top: 8px;">
                <strong>Why it matters:</strong> Can't optimize for quality without grades. Leapfrog covers ~2,000 hospitals but
                API access is limited and many providers not graded.
              </div>
            </div>

            <div class="data-gap-item">
              <span class="gap-priority highest">HIGHEST PRIORITY</span>
              <div class="data-source-name">Employer Claims Data</div>
              <div class="data-source-desc" style="margin-top: 8px;">
                <strong>Why it matters:</strong> Need actual spending patterns to calculate savings, detect issues, optimize networks.
                TPAs often resist sharing this data.
              </div>
            </div>

            <div class="data-gap-item">
              <span class="gap-priority high">HIGH PRIORITY</span>
              <div class="data-source-name">TPA/PBM Fee Transparency</div>
              <div class="data-source-desc" style="margin-top: 8px;">
                <strong>Why it matters:</strong> Spread pricing, float income, and hidden fees are where 20-40% leaks.
                Mandatory disclosure would reveal true costs.
              </div>
            </div>

            <div class="data-gap-item">
              <span class="gap-priority medium">MEDIUM PRIORITY</span>
              <div class="data-source-name">Contract Terms & Conditions</div>
              <div class="data-source-desc" style="margin-top: 8px;">
                <strong>Why it matters:</strong> Hard to compare TPA offerings, identify conflicts, understand risk transfer.
                Standardized disclosure would help employers.
              </div>
            </div>
          </div>

          <div class="alert alert-info" style="margin-top: 24px;">
            <div>
              <strong>Progress & Gaps:</strong> Federal transparency laws (CAA 2021, Hospital Price Transparency) provide pricing data.
              But quality data, fee transparency, and claims access remain gaps. Filling these gaps would complete the picture.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Interactive Stakeholder Map -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">Interactive Stakeholder Map</h2>
      <p class="section-subtitle">Click any stakeholder to see their role, incentives, available data, and power dynamics</p>

      <div class="stakeholder-map-container">
        <!-- Graph Visualization -->
        <div id="cy-container">
          <div class="view-controls">
            <button class="view-mode-btn active" data-layer="simple" onclick="changeLayer('simple')">
              <i class="fa-solid fa-eye"></i> Simple View
            </button>
            <button class="view-mode-btn" data-layer="standard" onclick="changeLayer('standard')">
              <i class="fa-solid fa-eye"></i> Standard View
            </button>
            <button class="view-mode-btn" data-layer="detailed" onclick="changeLayer('detailed')">
              <i class="fa-solid fa-eye"></i> Detailed View
            </button>
          </div>

          <div class="view-legend">
            <h4 style="font-size: var(--text-sm); font-weight: var(--font-bold); margin-bottom: 12px; text-transform: uppercase;">
              Stakeholder Alignment
            </h4>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--color-success);"></div>
              <span>Aligned (Good Guys)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--color-error);"></div>
              <span>Misaligned (Problems)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--color-warning);"></div>
              <span>Mixed (Context Dependent)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--color-patient-primary);"></div>
              <span>Neutral (Infrastructure)</span>
            </div>
          </div>

          <div id="cy"></div>
        </div>

      </div>
    </div>
  </section>

  <!-- Modal Overlay (appears on node click) -->
  <div id="modal-overlay" class="modal-overlay" onclick="closeModalOnBackdrop(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
          <div id="modal-icon" class="modal-icon"></div>
          <div>
            <h3 id="modal-title" style="font-size: var(--text-3xl); font-weight: var(--font-bold); margin: 0; line-height: 1.2;"></h3>
            <div id="modal-category" style="font-size: var(--text-md); color: var(--color-gray-600); margin-top: 4px;"></div>
          </div>
        </div>
        <div class="modal-close" onclick="closeModal()">&times;</div>
      </div>

      <div class="modal-body">
        <div class="modal-main-content" id="modal-main-content">
          <!-- Left column content will be dynamically populated -->
        </div>
        <div class="modal-sidebar-content" id="modal-sidebar-content">
          <!-- Right column content will be dynamically populated -->
        </div>
      </div>
    </div>
  </div>

  <!-- Interactive Deep Dives Section -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">Interactive Deep Dives</h2>
      <p class="section-subtitle">
        Explore advanced visualizations showing how money flows, who has power, and where conflicts exist
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <a href="../../diagrams/diagram1.html" class="card" style="text-decoration: none; color: inherit; cursor: pointer; transition: all 0.3s;">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: var(--color-patient-light); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i class="fa-solid fa-network-wired" style="font-size: 24px; color: var(--color-patient-primary);"></i>
            </div>
            <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 0;">
              Full Ecosystem Map
            </h3>
          </div>
          <p style="color: var(--color-gray-700); margin: 0;">
            Interactive network visualization showing all 17 stakeholders and their complex relationships
          </p>
        </a>

        <a href="../../diagrams/diagram2.html" class="card" style="text-decoration: none; color: inherit; cursor: pointer; transition: all 0.3s;">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: var(--color-success); color: white; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i class="fa-solid fa-dollar-sign" style="font-size: 24px;"></i>
            </div>
            <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 0;">
              Money Flows
            </h3>
          </div>
          <p style="color: var(--color-gray-700); margin: 0;">
            Follow the dollar from employer to provider - see where 30% disappears along the way
          </p>
        </a>

        <a href="../../diagrams/diagram3.html" class="card" style="text-decoration: none; color: inherit; cursor: pointer; transition: all 0.3s;">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: var(--color-warning); color: white; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i class="fa-solid fa-bolt" style="font-size: 24px;"></i>
            </div>
            <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 0;">
              Power Dynamics
            </h3>
          </div>
          <p style="color: var(--color-gray-700); margin: 0;">
            Understand who has leverage over whom - and why patients lose every negotiation
          </p>
        </a>

        <a href="../../diagrams/diagram4.html" class="card" style="text-decoration: none; color: inherit; cursor: pointer; transition: all 0.3s;">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: var(--color-error); color: white; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i class="fa-solid fa-shield-alt" style="font-size: 24px;"></i>
            </div>
            <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 0;">
              Conflicts Map
            </h3>
          </div>
          <p style="color: var(--color-gray-700); margin: 0;">
            See where incentives misalign - brokers earning more when you pay more
          </p>
        </a>

        <a href="../../diagrams/diagram5.html" class="card" style="text-decoration: none; color: inherit; cursor: pointer; transition: all 0.3s;">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: var(--color-provider-primary); color: white; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i class="fa-solid fa-sync-alt" style="font-size: 24px;"></i>
            </div>
            <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 0;">
              Transformation
            </h3>
          </div>
          <p style="color: var(--color-gray-700); margin: 0;">
            How transparency changes power dynamics and realigns incentives
          </p>
        </a>

        <a href="../../index.html" class="card" style="text-decoration: none; color: inherit; cursor: pointer; transition: all 0.3s; border: 2px solid var(--color-patient-primary);">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
            <div style="width: 48px; height: 48px; background: var(--color-gray-900); color: white; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <i class="fa-solid fa-book-open" style="font-size: 24px;"></i>
            </div>
            <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 0;">
              The Full Story
            </h3>
          </div>
          <p style="color: var(--color-gray-700); margin: 0;">
            Read the complete narrative with Sarah's story, Cuban's questions, and PBGH's proof
          </p>
        </a>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="section bg-gray-50">
    <div class="container">
      <div class="alert alert-info" style="margin-bottom: 32px;">
        <div>
          <strong>How to Use:</strong> Toggle between Simple, Standard, and Detailed views to see different levels of complexity.
          Click any stakeholder node to see detailed information about their role, incentives, available data sources, and what's missing.
          Use this map to understand the ecosystem and plan your strategy for using transparency data.
        </div>
      </div>

      <div class="text-center">
      <h2 class="section-title">Ready to Use Transparency Data?</h2>
      <p style="font-size: var(--text-lg); color: var(--color-gray-700); max-width: 700px; margin: 0 auto 32px;">
        Now that you understand the ecosystem, explore tools designed for your stakeholder group.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card" style="text-align: center;">
          <div style="font-size: 48px; margin-bottom: 16px; color: var(--color-patient-primary);"><i class="fa-solid fa-hospital"></i></div>
          <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin-bottom: 12px;">
            For Patients
          </h3>
          <p style="color: var(--color-gray-700); margin-bottom: 16px;">
            Search & compare provider prices and quality. Know before you go.
          </p>
          <a href="../patients/search.html" class="btn btn-primary" style="width: 100%;">Search Providers</a>
        </div>

        <div class="card" style="text-align: center;">
          <div style="font-size: 48px; margin-bottom: 16px; color: var(--color-employer-primary);"><i class="fa-solid fa-briefcase"></i></div>
          <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin-bottom: 12px;">
            For Employers
          </h3>
          <p style="color: var(--color-gray-700); margin-bottom: 16px;">
            Benchmark rates, detect spread pricing, find high-value providers.
          </p>
          <a href="../employers/benchmark.html" class="btn btn-primary" style="width: 100%; background: var(--color-employer-primary);">Benchmark Rates</a>
        </div>

        <div class="card" style="text-align: center;">
          <div style="font-size: 48px; margin-bottom: 16px; color: var(--color-provider-primary);"><i class="fa-solid fa-user-doctor"></i></div>
          <h3 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin-bottom: 12px;">
            For Providers
          </h3>
          <p style="color: var(--color-gray-700); margin-bottom: 16px;">
            See your market position, build direct contract proposals.
          </p>
          <a href="../providers/market-intel.html" class="btn btn-primary" style="width: 100%; background: var(--color-provider-primary);">Market Intelligence</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer style="background-color: var(--color-gray-900); color: var(--color-gray-300); padding: 48px 0;">
    <div class="container">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <h4 style="color: var(--color-white); font-weight: var(--font-bold); margin-bottom: 16px;">
            For Stakeholders
          </h4>
          <ul style="list-style: none; padding: 0; margin: 0; font-size: var(--text-sm);">
            <li style="margin-bottom: 8px;"><a href="../patients/index.html" style="color: var(--color-gray-300);">For Patients</a></li>
            <li style="margin-bottom: 8px;"><a href="../employers/index.html" style="color: var(--color-gray-300);">For Employers</a></li>
            <li style="margin-bottom: 8px;"><a href="../providers/index.html" style="color: var(--color-gray-300);">For Providers</a></li>
            <li style="margin-bottom: 8px;"><a href="../index.html" style="color: var(--color-gray-300);">Back to Home</a></li>
          </ul>
        </div>

        <div>
          <h4 style="color: var(--color-white); font-weight: var(--font-bold); margin-bottom: 16px;">
            Learn
          </h4>
          <ul style="list-style: none; padding: 0; margin: 0; font-size: var(--text-sm);">
            <li style="margin-bottom: 8px;"><a href="stakeholder-map.html" style="color: var(--color-gray-300);">Healthcare Stakeholder Map</a></li>
            <li style="margin-bottom: 8px;"><a href="../patients/learn.html" style="color: var(--color-gray-300);">Healthcare 101</a></li>
            <li style="margin-bottom: 8px;"><a href="#" style="color: var(--color-gray-300);">Data Sources</a></li>
            <li style="margin-bottom: 8px;"><a href="../../glossary.html" style="color: var(--color-gray-300);">Glossary of Terms</a></li>
          </ul>
        </div>

        <div>
          <h4 style="color: var(--color-white); font-weight: var(--font-bold); margin-bottom: 16px;">
            Tools
          </h4>
          <ul style="list-style: none; padding: 0; margin: 0; font-size: var(--text-sm);">
            <li style="margin-bottom: 8px;"><a href="../patients/search.html" style="color: var(--color-gray-300);">Search Procedures</a></li>
            <li style="margin-bottom: 8px;"><a href="../employers/benchmark.html" style="color: var(--color-gray-300);">Benchmark Rates</a></li>
            <li style="margin-bottom: 8px;"><a href="../employers/spread-calculator.html" style="color: var(--color-gray-300);">Spread Calculator</a></li>
            <li style="margin-bottom: 8px;"><a href="../providers/market-intel.html" style="color: var(--color-gray-300);">Market Intelligence</a></li>
          </ul>
        </div>
      </div>

      <div style="border-top: 1px solid var(--color-gray-700); margin-top: 32px; padding-top: 32px; text-align: center; font-size: var(--text-sm);">
        <p>&copy; 2025 Healthcare Transparency Platform. Powered by real transparency data.</p>
      </div>
    </div>
  </footer>

  <script>
    // ============================================================================
    // MODULE TOGGLE
    // ============================================================================

    function toggleModule(moduleNum) {
      const header = document.querySelectorAll('.module-header')[moduleNum - 1];
      const content = document.getElementById(`module-${moduleNum}`);

      header.classList.toggle('collapsed');
      content.classList.toggle('visible');
    }

    // ============================================================================
    // CYTOSCAPE GRAPH INITIALIZATION
    // ============================================================================

    let cy;
    let currentLayer = 'simple';

    function initializeGraph() {
      console.log('initializeGraph called');
      console.log('StakeholderData:', typeof StakeholderData !== 'undefined' ? 'defined' : 'undefined');

      const container = document.getElementById('cy');
      console.log('Container:', container);

      // Build node and edge arrays from stakeholder data
      const { nodes, edges } = buildGraphElements(currentLayer);
      console.log('Nodes:', nodes.length, 'Edges:', edges.length);

      cy = cytoscape({
        container: container,
        elements: {
          nodes: nodes,
          edges: edges
        },
        style: [
          {
            selector: 'node',
            style: {
              'background-color': 'data(color)',
              'label': 'data(label)',
              'color': '#ffffff',
              'text-valign': 'center',
              'text-halign': 'center',
              'font-size': '12px',
              'font-weight': 'bold',
              'text-wrap': 'wrap',
              'text-max-width': '80px',
              'width': '80px',
              'height': '80px',
              'border-width': 3,
              'border-color': '#ffffff'
            }
          },
          {
            selector: 'node:selected',
            style: {
              'border-width': 5,
              'border-color': '#333333'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 'data(thickness)',
              'line-color': 'data(color)',
              'target-arrow-color': 'data(color)',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
              'opacity': 0.6
            }
          },
          {
            selector: 'edge[label]',
            style: {
              'label': 'data(label)',
              'font-size': '10px',
              'text-rotation': 'autorotate',
              'text-margin-y': -10,
              'color': '#666',
              'text-background-color': '#ffffff',
              'text-background-opacity': 0.8,
              'text-background-padding': '3px'
            }
          }
        ],
        layout: {
          name: 'cose',
          animate: true,
          animationDuration: 1000,
          nodeRepulsion: 8000,
          idealEdgeLength: 150,
          edgeElasticity: 100,
          nestingFactor: 1.2,
          gravity: 1,
          numIter: 1000,
          initialTemp: 200,
          coolingFactor: 0.95,
          minTemp: 1.0
        },
        minZoom: 0.5,
        maxZoom: 2
      });

      // Node click event
      cy.on('tap', 'node', function(evt) {
        const node = evt.target;
        const stakeholderId = node.data('id');
        showStakeholderDetails(stakeholderId);
      });

      // Click on background to close modal
      cy.on('tap', function(evt) {
        if (evt.target === cy) {
          closeModal();
        }
      });
    }

    function buildGraphElements(layer) {
      const layerNodes = StakeholderData.layers[layer].nodes;
      const nodes = [];
      const edges = [];

      // Build nodes
      layerNodes.forEach(nodeId => {
        const stakeholder = StakeholderData.stakeholders[nodeId];
        if (stakeholder) {
          nodes.push({
            data: {
              id: stakeholder.id,
              label: stakeholder.label,
              color: getCategoryColor(stakeholder.category),
              icon: stakeholder.icon
            }
          });
        }
      });

      // Build edges (only if both nodes are in current layer)
      StakeholderData.relationships.forEach(rel => {
        if (layerNodes.includes(rel.from) && layerNodes.includes(rel.to)) {
          edges.push({
            data: {
              source: rel.from,
              target: rel.to,
              label: rel.label || '',
              thickness: rel.thickness || 2,
              color: rel.color || '#95a5a6'
            }
          });
        }
      });

      return { nodes, edges };
    }

    function getCategoryColor(category) {
      const colors = {
        'aligned': '#10B981',      // --color-success
        'misaligned': '#EF4444',   // --color-error
        'mixed': '#F59E0B',        // --color-warning
        'neutral': '#0066CC'       // --color-patient-primary
      };
      return colors[category] || '#95a5a6';
    }

    // ============================================================================
    // LAYER SWITCHING
    // ============================================================================

    function changeLayer(layer) {
      currentLayer = layer;

      // Update button states
      document.querySelectorAll('.view-mode-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-layer') === layer) {
          btn.classList.add('active');
        }
      });

      // Rebuild graph
      const { nodes, edges } = buildGraphElements(layer);
      cy.elements().remove();
      cy.add(nodes);
      cy.add(edges);
      cy.layout({
        name: 'cose',
        animate: true,
        animationDuration: 1000,
        nodeRepulsion: 8000,
        idealEdgeLength: 150,
        edgeElasticity: 100,
        nestingFactor: 1.2,
        gravity: 1,
        numIter: 1000,
        initialTemp: 200,
        coolingFactor: 0.95,
        minTemp: 1.0
      }).run();

      // Close modal
      closeModal();
    }

    // ============================================================================
    // STAKEHOLDER DETAILS PANEL
    // ============================================================================

    function showStakeholderDetails(stakeholderId) {
      const stakeholder = StakeholderData.stakeholders[stakeholderId];
      if (!stakeholder) return;

      // Show modal
      const modal = document.getElementById('modal-overlay');
      modal.classList.add('visible');
      document.body.style.overflow = 'hidden'; // Prevent background scrolling

      // Set icon
      const iconDiv = document.getElementById('modal-icon');
      iconDiv.style.background = stakeholder.color;
      iconDiv.innerHTML = `<i class="fa-solid ${stakeholder.icon}"></i>`;

      // Set title
      document.getElementById('modal-title').textContent = stakeholder.label.replace('\n', ' ');

      // Set category
      const categoryLabels = {
        'aligned': 'Aligned Stakeholder',
        'misaligned': 'Misaligned Stakeholder',
        'mixed': 'Mixed Incentives',
        'neutral': 'Neutral Infrastructure'
      };
      document.getElementById('modal-category').textContent = categoryLabels[stakeholder.category] || '';

      // Build main content (left column - 60%)
      let mainContent = `
        <div style="margin-bottom: 24px;">
          <p style="color: var(--color-gray-700); line-height: 1.6; font-size: var(--text-lg);">${stakeholder.description}</p>
        </div>
      `;

      // Metrics (main content)
      if (stakeholder.metrics && Object.keys(stakeholder.metrics).length > 0) {
        mainContent += `<h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin-bottom: 12px;">Key Metrics</h4>`;
        mainContent += `<div class="metric-grid">`;
        Object.entries(stakeholder.metrics).forEach(([key, value]) => {
          const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
          mainContent += `
            <div class="metric-card">
              <div class="metric-label">${label}</div>
              <div class="metric-value">${value}</div>
            </div>
          `;
        });
        mainContent += `</div>`;
      }

      // Incentives (main content)
      if (stakeholder.incentives) {
        mainContent += `<h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 24px 0 12px;">Incentives</h4>`;

        if (stakeholder.incentives.aligned && stakeholder.incentives.aligned.length > 0) {
          mainContent += `<div style="margin-bottom: 12px;"><strong style="color: var(--color-success); font-size: var(--text-lg);">Aligned:</strong></div>`;
          mainContent += `<div class="incentive-list">`;
          stakeholder.incentives.aligned.forEach(item => {
            mainContent += `<div class="incentive-item"><i class="fa-solid fa-check" style="color: var(--color-success);"></i><span>${item}</span></div>`;
          });
          mainContent += `</div>`;
        }

        if (stakeholder.incentives.misaligned && stakeholder.incentives.misaligned.length > 0) {
          mainContent += `<div style="margin: 12px 0;"><strong style="color: var(--color-error); font-size: var(--text-lg);">Misaligned:</strong></div>`;
          mainContent += `<div class="incentive-list">`;
          stakeholder.incentives.misaligned.forEach(item => {
            mainContent += `<div class="incentive-item"><i class="fa-solid fa-xmark" style="color: var(--color-error);"></i><span>${item}</span></div>`;
          });
          mainContent += `</div>`;
        }
      }

      // Power Dynamics (main content)
      if (stakeholder.power) {
        mainContent += `<h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 24px 0 12px;">Power Dynamics</h4>`;

        if (stakeholder.power.has && stakeholder.power.has.length > 0) {
          mainContent += `<div style="margin-bottom: 12px;"><strong style="color: var(--color-success); font-size: var(--text-lg);">Has Power Over:</strong></div>`;
          mainContent += `<div class="incentive-list">`;
          stakeholder.power.has.forEach(item => {
            mainContent += `<div class="incentive-item"><i class="fa-solid fa-check" style="color: var(--color-success);"></i><span>${item}</span></div>`;
          });
          mainContent += `</div>`;
        }

        if (stakeholder.power.lacks && stakeholder.power.lacks.length > 0) {
          mainContent += `<div style="margin: 12px 0;"><strong style="color: var(--color-error); font-size: var(--text-lg);">Lacks Power Over:</strong></div>`;
          mainContent += `<div class="incentive-list">`;
          stakeholder.power.lacks.forEach(item => {
            mainContent += `<div class="incentive-item"><i class="fa-solid fa-xmark" style="color: var(--color-error);"></i><span>${item}</span></div>`;
          });
          mainContent += `</div>`;
        }
      }

      // Start sidebar content (right column - 40%)
      let sidebarContent = '';

      // Data Sources (sidebar)
      if (stakeholder.dataSources) {
        if (stakeholder.dataSources.available && stakeholder.dataSources.available.length > 0) {
          sidebarContent += `<h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin-bottom: 12px;"><i class="fa-solid fa-database" style="margin-right: 8px; color: var(--color-success);"></i>Available Data</h4>`;
          sidebarContent += `<div class="data-source-list">`;
          stakeholder.dataSources.available.forEach(source => {
            sidebarContent += `
              <div class="data-source-item">
                <div class="data-source-name">${source.name}</div>
                <div class="data-source-records">${source.records}  ${source.source}</div>
                <div class="data-source-desc">${source.description}</div>
              </div>
            `;
          });
          sidebarContent += `</div>`;
        }

        if (stakeholder.dataSources.gaps && stakeholder.dataSources.gaps.length > 0) {
          sidebarContent += `<h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 24px 0 12px;"><i class="fa-solid fa-circle-exclamation" style="margin-right: 8px; color: var(--color-error);"></i>Data Gaps</h4>`;
          sidebarContent += `<div class="data-source-list">`;
          stakeholder.dataSources.gaps.forEach(gap => {
            sidebarContent += `
              <div class="data-gap-item">
                <span class="gap-priority ${gap.priority.toLowerCase().replace(' ', '-')}">${gap.priority} PRIORITY</span>
                <div class="data-source-name">${gap.name}</div>
                <div class="data-source-desc" style="margin-top: 8px;"><strong>Impact:</strong> ${gap.impact}</div>
                <div class="data-source-desc" style="margin-top: 4px;"><strong>Solution:</strong> ${gap.solution}</div>
              </div>
            `;
          });
          sidebarContent += `</div>`;
        }
      }

      // Query Examples (sidebar)
      if (stakeholder.queries && stakeholder.queries.length > 0) {
        sidebarContent += `<h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 24px 0 12px;"><i class="fa-solid fa-magnifying-glass" style="margin-right: 8px;"></i>Example Queries</h4>`;
        stakeholder.queries.forEach(query => {
          sidebarContent += `<div class="query-example">"${query}"</div>`;
        });
      }

      // Actions (sidebar)
      if (stakeholder.actions && stakeholder.actions.length > 0) {
        sidebarContent += `<h4 style="font-size: var(--text-xl); font-weight: var(--font-bold); margin: 24px 0 12px;">Take Action</h4>`;
        sidebarContent += `<div class="action-buttons">`;
        stakeholder.actions.forEach(action => {
          sidebarContent += `<a href="${action.link}" class="btn btn-primary" style="width: 100%;">${action.label}</a>`;
        });
        sidebarContent += `</div>`;
      }

      // Set content in both columns
      document.getElementById('modal-main-content').innerHTML = mainContent;
      document.getElementById('modal-sidebar-content').innerHTML = sidebarContent;
    }

    function closeModal() {
      const modal = document.getElementById('modal-overlay');
      modal.classList.remove('visible');
      document.body.style.overflow = ''; // Restore scrolling
      if (cy) {
        cy.nodes().unselect();
      }
    }

    function closeModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeModal();
      }
    }

    // ESC key handler
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('modal-overlay');
        if (modal && modal.classList.contains('visible')) {
          closeModal();
        }
      }
    });

    // ============================================================================
    // INITIALIZATION
    // ============================================================================

    document.addEventListener('DOMContentLoaded', function() {
      initializeGraph();
    });
  </script>
</body>
</html>
